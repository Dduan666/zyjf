{__NOLAYOUT__}
<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title></title>
		<link rel="stylesheet" type="text/css" href="__PUBLIC__/zynw/css/bootstrap.min.css"/>
		<link rel="stylesheet" type="text/css" href="__PUBLIC__/zynw/css/fengkong.css"/>
	    <link rel="stylesheet" type="text/css" href="__PUBLIC__/zynw/css/jquery-ui.css"/>
	</head>
	<body>
		<div class="big_div_chanpin">
			<div class="fenleiguanli"><a href="">风控管理</a> >产品管理 > <span>中信银行</span></div>
		<div class="con_wwl">
			<div class="fenlei_table">
				<table class="table table_fl">
					<tbody class="tbody">
					<tr class="bjys">
						<td>ID</td>
						<td>产品分类</td>
						<td>产品名称</td>
						<td>排序</td>
						<td>管理</td>
					</tr>
					<foreach name="res" item="rr">
					<tr>
						<td>{$rr['id']}</td>
						<td>{$rr['class']}</td>
						<td>{$rr['product']}</td>
						<td>{$rr['sort']}</td>
						<td><button class="btn btn-default btn_left click_btn" onclick="cp_xiugai(this)" value="{$rr['id']}">修改</button><button class="btn btn-default" value="{$rr['id']}" onclick="cp_shanchu(this)">删除</button></td>
					</tr>
					</foreach>
					
					</tbody>
				</table>
				
				
			</div>
		</div>

		<div class="title_add_cp">+新增产品</div>
	<form id="form11">
		<input type="hidden" name="like[]" id="sss" value="0">
		<textarea style="display:none;" id="ccc" name="content[]" type="0"></textarea>
		<div class="con_wwl add_tj_cp">
			<div class="new_xiu">
				<div class="new_title">新增产品</div>
				
				<div class="guize">
					<span class="span_fenl">银行:</span>
					<select name="" class="select_conmmon bank" onchange="change();">
							<option value="" id="" disabled="true" selected="selected">--请选择--</option>
						<foreach name="data" item="dd">
							<option value="{$dd['id']}" id="bank" >{$dd['class']}</option>
						</foreach>
					</select>
				</div>
					
					<div class="guize">
					<span class="span_fenl">分类名称:</span>
					<select name="cid" class="select_conmmon chan">
							<option value="" id="" disabled="true" selected="selected">--请选择--</option>
					</select>
				</div>
					<div class="guize">
					<span class="span_fenl">前台显示:</span>
					<select name="nid" class="select_conmmon qian">
						<option value="" id="" disabled="true" selected="selected">--请选择--</option>
						<option value="1">短借垫资</option>
						<option value="2">抵押消费贷</option>
						<option value="3">经营性抵押物业</option>
						<option value="4">抵押经营贷</option>
						<option value="5">房抵净值经营贷</option>
						<option value="6">信用贷</option>
						<option value="7">房抵贷经营性收入</option>
						<option value="8">配套抵押</option>
					</select>
					<!-- <select name="nid" class="select_conmmon xiao">
						<option value="" id="" disabled="true" selected="selected">--请选择--</option>
					</select> -->
				</div>
				<div class="guize">
					<span class="span_fenl">产品名称:</span>
					<input type="text" name="product" id="" value="" class="input_conmmon2 product"/>
				</div>
				
				<div class="guize">
					<span class="span_fenl">计息方式:</span>
					<select name="mode" class="select_conmmon">
						<option value="1">等额本金</option>
						<option value="2">等额本息</option>
						<option value="3">先息后本</option>
					</select>
				</div>
				
					<div class="guize">
					<span class="span_fenl">贷款额度:</span>
					<input type="text" name="money" id="" value="" class="input_conmmon2 money"/>
					<div class="posi_dw">万元</div>
				</div>
					<div class="guize">
					<span class="span_fenl">贷款期限:</span>
					<input type="text" name="year" id="" value="" class="input_conmmon2 year"/>
					<div class="posi_dw">年</div>
				</div>
				
				<div class="ouno tian">
					<div class="guize">
						<span class="span_fenl">准入条件:</span>
						<textarea class="text_area" name="conts" style="width:450px;"></textarea>
					</div>
					<!-- <div class="guize">
						<span class="span_fenl">抵押物要求:</span>
						<textarea class="text_area"></textarea>
					</div> -->
				</div>
					<div class="guize">
					<span class="span_fenl"></span>
					<span class="submit_tianjia" onclick="add_tijiao()"><span class="add_icon">+</span>添加条件</span>
				</div>
				
				<div class="guize">
					<span class="span_fenl">分类排序:</span>
					<input type="text" name="sort" id="" value="" class="input_conmmon"/>
				</div>
				
						<div class="guize">
					<span class="span_fenl">是否启用:</span>
					<input type="checkbox" name="status" id="qiyong" class="" value="1"/>
					<label for="qiyong">点击启用</label>
				</div>
						<div class="guize">
					<span class="span_fenl"></span>
					<span class="submit_cp" onclick="product();">提交</span>
				</div>

			</div>
		
		</div>
	</form>

	<!--产品信息修改-->
	<form id="form22" name="add" method="post">
		<div class="con_wwl add_xiugai_cp" id="editForm11" style="display: none;">
		<input type="hidden" name="id" value="" class="id11">
		<input type="hidden" name="like[]" id="sss22" value="0">
		<input type="hidden" name="tiao" value="" class="count">
		<textarea style="display:none;" id="ccc22" name="content[]" type="0"></textarea>
			<div class="new_xiu">
				<div class="new_title">修改产品</div>
				
				<div class="guize">
					<span class="span_fenl">银行:</span>
					<select name="" class="select_conmmon bank11" onchange="change3()" id="bankSelect">
						<option value="" id="" disabled="true" selected="selected">--请选择--</option>
						<foreach name="data" item="dd">
							<option value="{$dd['id']}" class="bb{$dd['id']}">{$dd['class']}</option>
						</foreach>
					</select>
				</div>
					
					<div class="guize">
					<span class="span_fenl">分类名称:</span>
					<select name="cid" class="select_conmmon chan11" id="navSelect">
						<option value="" id="" disabled="true">--请选择--</option>
					</select>
				</div>
					<div class="guize">
					<span class="span_fenl">前台显示:</span>
					<select name="nid" class="select_conmmon qian11">
						<option value="" id="" disabled="true" selected="selected">--请选择--</option>
						<option value="1">短借垫资</option>
						<option value="2">抵押消费贷</option>
						<option value="3">经营性抵押物业</option>
						<option value="4">抵押经营贷</option>
						<option value="5">房抵净值经营贷</option>
						<option value="6">信用贷</option>
						<option value="7">房抵贷经营性收入</option>
						<option value="8">配套抵押</option>
					</select>
					<!-- <select name="nid" class="select_conmmon xiao11" id="conSelect">
						<option value="" id="" disabled="true" >--请选择--</option>
					</select> -->
				</div>
				<div class="guize">
					<span class="span_fenl">产品名称:</span>
					<input type="text" name="product" id="" value="" class="input_conmmon2 product11"/>
				</div>
				
				<div class="guize">
					<span class="span_fenl">计息方式:</span>
					<select name="mode" class="select_conmmon lixi">
						<option value="1">等额本金</option>
						<option value="2">等额本息</option>
						<option value="3">到期还本</option>
					</select>
				</div>
				
					<div class="guize">
					<span class="span_fenl">贷款额度:</span>
					<input type="text" name="money" id="" value="" class="input_conmmon2 money11"/>
					<div class="posi_dw">万元</div>
				</div>
					<div class="guize">
					<span class="span_fenl">贷款期限:</span>
					<input type="text" name="year" id="" value="" class="input_conmmon2 year11"/>
					<div class="posi_dw">月</div>
				</div>

				<div class="guize">
						<span class="span_fenl">准入条件:</span>
						<textarea class="text_area conts11" name="conts" style="width:450px;"></textarea>
				</div>
				<div class="ouno xiu">
					
				</div>
				<div class="guize">
					<span class="span_fenl"></span>
					<span class="submit_tianjia" onclick="add_tijiao2()"><span class="add_icon">+</span>添加条件</span>
				</div>
				
				<div class="guize">
					<span class="span_fenl">分类排序:</span>
					<input type="text" name="sort" id="" value="" class="input_conmmon sort11"/>
				</div>
				
						<div class="guize">
					<span class="span_fenl">是否启用:</span>
					<input type="checkbox"  name="status" id="x_qiyong" value="1" class="status"/>
					<label for="x_qiyong">点击启用</label>
				</div>
						<div class="guize">
					<span class="span_fenl"></span>
					<span class="submit_cp_xiugai" onclick="xiugai();">提交</span>
				</div>

			</div>
		
		</div>
	</form>
	</div>
	
   <div id="dialog" title="温馨提示！" style="display: none;">
  <p class="xiu_tis_con">修改成功！</p>
   </div>
   
	</body>
</html>


<script src="__PUBLIC__/zynw/js/jquery.js" type="text/javascript"></script>
<script src="__PUBLIC__/zynw/js/jquery-ui.min.js" type="text/javascript"></script>

<script type="text/javascript">
$(function(){
	$('.tbody>tr:odd').addClass('green');
})
	//显示新增产品页
	$('.title_add_cp').click(function(){
    	$(".add_tj_cp").show();
    	$('.add_xiugai_cp').hide();
	})
	//点击添加后隐藏
	// $(".submit_cp").click(function(){
	// 	$(".add_tj_cp").hide();
	// })
	
	//点击修改后隐藏
	// 	$(".submit_cp_xiugai").click(function(){
	// 	$(".add_xiugai_cp").hide();
	// })
	//添加时jQuery无限添加
	function add_tijiao(){
		var like = parseInt($('#sss').val())+1;
		var cont = parseInt($('#ccc').attr("type"))+1;
		
		var str='<div class="guize"><span class="span_fenl"> <input type="text" name="like['+like+']" class="name"/> </span>：<textarea class="text_area" name="content['+cont+']" style="width:450px;"></textarea><button class="btn btn-default">删除</button></div>';
		$('#sss').val(like);
		$('#ccc').attr("type",cont);
		$(".tian").append(str);
		
	}

	//修改时jQuery无限添加
	function add_tijiao2(){
		
		//添加条件
		var like = parseInt($('#sss22').val())+1;
		var cont = parseInt($('#ccc22').attr("type"))+1;
		
		var str='<div class="guize"><span class="span_fenl"> <input type="text" name="like['+like+']" class="name"/> </span>：<textarea class="text_area" name="content['+cont+']" style="width:450px;"></textarea></div>';
		$('#sss22').val(like);
		$('#ccc22').attr("type",cont);
		$(".xiu").append(str);
		
	}
	
	//添加
	function product()
	{	
		
		$.ajax({
			type:'post',
			url:'{:U('Ain/Feng/productAjax')}',
			data:$('#form11').serialize(),
			success:function(aa){
			
				if(aa==1){
					alert('请选择分类名称!');
				}else if(aa==2){
					alert('请选择前台显示的分类!');
				}else if(aa==3){
					alert('填写产品名称!');
				}else if(aa==4){
					alert('此产品已存在,请不要重复添加!');
				}else if(aa==12){
					alert('前台分类下此产品已存在,请不要重复添加!!');
				}else if(aa==5){
					alert('贷款额度不能为空!');
				}else if(aa==6){
					alert('贷款期限不能为空!');
				}else if(aa==7){
					alert('准入条件不能为空!');
				}else if(aa==8){
					alert('序号不能为空!');
				}else if(aa==9){
					alert('这个序号在此分类下已存在，请重新填写!');
				}else if(aa==10){
					alert('添加成功');
					$(".add_tj_cp").hide();
					window.location.href="{:U('Ain/Feng/fengkong_right0',array('id'=>$_GET['id']))}";
				}else{
					alert('添加失败，请重新添加!');
				}
			}
		})	
	}

	//点击修改时显示修改页,并把id传过去
	function cp_xiugai(obj){
		$(".xiu").html("");

		// window.location.href="{:U('Ain/Feng/')}";
		$(".add_tj_cp").hide();
		$(".add_xiugai_cp").show();
		var id = $(obj).val();
		var xiao = $('.xiao11 > option:gt(0)').html();
		var chan = $('.chan11 > option:gt(0)').html();
		$.ajax({
			type : 'post',
			url : '{:U('Ain/Feng/edit')}',
			data : {id:id},
			success : function(de){

				// $('#sss22').val(de.count-1);//查出无限添加的条件的个数，以便下面添加条件的属性值不会重复覆盖
				// $('#ccc22').attr("type",de.count-1);//查出无限添加的条件的个数，以便下面添加条件的属性值不会重复覆盖
				$('#editForm11 .count').val(de.tiao);//赋予id，以便接下来的修改提交
				$('#editForm11 .id11').val(de.id);//赋予id，以便接下来的修改提交
				$('#editForm11 .bank11 .bb'+de.fid)[0].selected=true;//所属银行
				$('#editForm11 .product11').val(de.product);//产品名称
				if(chan == null){
					$.each(de.nav,function(i,n){
						var dat = '<option value="'+n.id+'" >'+n.class+'</option>';//银行下分类为空时才进行查询拼接上
						$('.chan11').append(dat);
					})
				}
				$('#navSelect ').val(de.cid).selected=true;//分类名称	

				$('#editForm11 .qian11').val(de.nid).selected=true;//前台显示大分类
				// if(xiao == null){
				// 	$.each(de.con,function(i,n){
				// 		var dat = '<option value="'+n.id+'" >'+n.name+'</option>';//前台显示分类为空时才进行查询拼接
				// 		$('.xiao11').append(dat);
				// 	})
				// }
				$('#conSelect ').val(de.nid).selected=true;//前台显示下的小分类

				$('#editForm11 .lixi').val(de.mode).selected=true;//所属计息方式
				$('#editForm11 .money11').val(de.money);//额度
				$('#editForm11 .year11').val(de.year);//年限
				$('#editForm11 .conts11').val(de.conts);//准入条件
				$('#editForm11 .sort11').val(de.sort);//排序

				
				$.each(de.p_con,function(k,m){
					
					var str='<div class="guize"><span class="span_fenl"> <input type="text" name="lis['+m.id+']" class="name" value="'+m.like+'"/> </span>：<textarea class="text_area" name="cos['+m.id+']" value="" style="width:450px;">'+m.content+'</textarea><span style="color:red;" class="shans" type="'+m.id+'" onclick="shan(this)">删除</span></div>';
					
					$(".xiu").append(str);
				})

				$('#editForm11 .status')[0].checked=(de.status==1)?true:false;//状态
			}
		});
	
	}
	//删除无限添加到的这条数据
	function shan(obj){
		$(obj).parents('.guize').remove();//在前台删除这条
		var id = $(obj).attr('type');
		$.ajax({
			type : 'post',
			url : '{:U('Ain/Feng/deles')}',
			data : {id:id},
			success : function(data){
				// alert(data)
			}
		})
		
	}
	
	//修改时ajax查出所属分类名称

	function change3(){
		$('.chan11>option:gt(0)').remove();
		var id = $('.bank11>option:checked').val();
		
		$.ajax({
			type : 'post',
			url : '{:U('Ain/Feng/fengkong_ajax')}',
			data : {pid:id},
			success : function(data){
				var de = eval("("+data+")");
				
				$.each(de,function(i,n){
					var dat = '<option value="'+n.id+'">'+n.class+'</option>';
					$('.chan11').append(dat);
				});
			}
		})
	}

	//修改时ajax查出所属前台显示分类名称
	// function change4(){
	// 	$('.xiao11>option:gt(0)').remove();
	// 	var id = $('.qian11>option:checked').val();
		
	// 	$.ajax({
	// 		type : 'post',
	// 		url : '{:U('Ain/Feng/fengkong_ajax2')}',
	// 		data : {pid:id},
	// 		success : function(data){
	// 			var de = eval("("+data+")");
				
	// 			$.each(de,function(i,n){
	// 				var dat = '<option value="'+n.id+'">'+n.name+'</option>';
	// 				$('.xiao11').append(dat);
	// 			});
	// 		}
	// 	})
	// }


	//添加时ajax查出所属分类名称
	function change(){
		$('.chan>option:gt(0)').remove();
		var id = $('.bank>option:checked').val();
		
		$.ajax({
			type : 'post',
			url : '{:U('Ain/Feng/fengkong_ajax')}',
			data : {pid:id},
			success : function(data){
				var de = eval("("+data+")");
				
				$.each(de,function(i,n){
					var dat = '<option value="'+n.id+'">'+n.class+'</option>';
					$('.chan').append(dat);
				});
			}
		})
	}
	//添加时ajax查出所属前台显示分类名称
	// function change2(){
	// 	$('.xiao>option:gt(0)').remove();
	// 	var id = $('.qian>option:checked').val();
		
	// 	$.ajax({
	// 		type : 'post',
	// 		url : '{:U('Ain/Feng/fengkong_ajax2')}',
	// 		data : {pid:id},
	// 		success : function(data){
	// 			var de = eval("("+data+")");
				
	// 			$.each(de,function(i,n){
	// 				var dat = '<option value="'+n.id+'">'+n.name+'</option>';
	// 				$('.xiao').append(dat);
	// 			});
	// 		}
	// 	})
	// }

	//修改
	function xiugai(){
		
		$.ajax({
			type:'post',
			url:'{:U('Ain/Feng/productGai')}',
			data:$('#form22').serialize(),
			success:function(xiu){
				
				if(xiu == 1){
					alert('修改成功！');
					$(".add_xiugai_cp").hide();
					window.location.href="{:U('Ain/Feng/fengkong_right0',array('id'=>$_GET['id']))}";
				}else if(xiu == 0){
					alert('修改失败！');
				}else if(xiu == 2){
					alert('产品名称不能为空!');
				}else if(xiu == 3){
					alert('贷款金额不能为空!');
				}else if(xiu == 4){
					alert('贷款年限不能为空!');
				}else if(xiu == 5){
					alert('准入条件不能为空!');
				}else if(xiu == 6){
					alert('产品的序号不能为空!');
				}else if(xiu == 7){
					alert('此分类下的产品名称已存在!');
				}else if(xiu == 8){
					alert('此分类下的序号已存在!');
				}
			}
		})	
	}

	//删除的操作
	function cp_shanchu(obj){
		var id = $(obj).val();

		if(confirm("确定要删除吗？")){ 
			$.ajax({
				type:'post',
				url:'{:U('Ain/Feng/prodel')}',
				data:{id:id},
				success : function(pro){
					if(pro==1){
						alert('删除成功!');
						window.location.href="{:U('Ain/Feng/fengkong_right0',array('id'=>$_GET['id']))}";
					}else{
						alert('删除失败!');
						window.location.href="{:U('Ain/Feng/fengkong_right0',array('id'=>$_GET['id']))}";
					}
				}
			});
			return true; 
		}else{ 
			return false; 
		} 
	}
</script>
